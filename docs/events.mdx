---
title: Event Operations Guide
description: Operator guidance for event flow, delivery guarantees, and troubleshooting.
---

Crabstack components exchange a canonical event envelope across ingress, gateway, and subscribers.

For full envelope and payload contracts, see [Integration Event Schema](./integrations/events.mdx).

## Key delivery behavior

- Turn-driving events are strictly ordered per session.
- Subscriber dispatch is eventual and at-least-once.
- Consumers must dedupe using `event_id` and/or `idempotency_key`.

## High-value event families

- Channel ingress: `channel.message.*` (see [Discord Listener](./discord.mdx))
- Agent lifecycle: `agent.turn.*`, `agent.response.created`
- Tool execution: `tool.call.*`
- Pairing lifecycle: `pairing.*` (control-plane initiated via admin socket)
- Config lifecycle: `config.applied`, `config.reverted`
- Scheduler/system: `cron.triggered`, `heartbeat.tick` (see [Cron Service](./cron.mdx))

## Routing behavior to know

- Gateway routes by `tenant_id`, `agent_id`, and `session_id`.
- `isolation_key` controls memory isolation.
- If an internal event omits output target, gateway falls back to session `last_active_channel`.

## Pairing event fields to monitor

- `pairing.started` and `pairing.failed` should include `remote_uri` and `initiated_via=admin_socket`.
- `pairing.started` should include `remote_component_type`.
- `pairing.completed` should include `remote_component_id`, remote keys, and `mtls_cert_fingerprint`.
- Pairing lifecycle events should report `source.transport=unix_socket`.

## Troubleshooting patterns

- Duplicates: verify downstream dedupe keys.
- Missing output target: inspect `last_active_channel` and route metadata.
- Remote trust issues: verify `peer_id` and `mtls_cert_fingerprint` on remote events.
- Pairing event mismatches: verify `initiated_via=admin_socket` and `source.transport=unix_socket`.
- Subscriber lag: inspect outbox retries and dead-letter flow.
